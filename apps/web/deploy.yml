# @format

name: Deploy to Portainer Frontend

on:
    push:
        branches: [develop]
    workflow_dispatch:

env:
    PORTAINER_URL: ${{ secrets.PORTAINER_URL }}
    PORTAINER_USERNAME: ${{ secrets.PORTAINER_USERNAME }}
    PORTAINER_PASSWORD: ${{ secrets.PORTAINER_PASSWORD }}
    STACK_NAME: sports-rekrytering

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Set up Node
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"

            - name: Install dependencies
              run: npm ci --legacy-peer-deps

            - name: Build
              run: npm run build --legacy-peer-deps

            - name: Login to Docker Hub
              uses: docker/login-action@v3
              with:
                  username: ${{ secrets.DOCKERHUB_USERNAME }}
                  password: ${{ secrets.DOCKERHUB_TOKEN }}

            - name: Build and push Docker image
              uses: docker/build-push-action@v5
              with:
                  context: .
                  push: true
                  tags: mmsoft/srs-frontend:latest

            - name: Trigger Portainer Webhook
              uses: fjogeleit/http-request-action@v1
              with:
                  url: "https://portainer.mmsoft.com.br/api/stacks/webhooks/2b96af4f-90f1-4a73-9868-22b999c6bf92"
                  method: "POST"
